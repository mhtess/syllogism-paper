var M22_PRAG_QUD_PRAG_STATE = function(){

  	var speakerOptimality = {
  		alpha_1 : uniformDrift({a: 0, b: 20, width: 2}),
      alpha_2 : uniformDrift({a: 0, b: 10, width: 2})
  	}

    var noise = uniformDrift({a: 0, b: 0.1, width: 0.01})

    var regionProbs = repeat(7, function(){ return uniformDrift({a: 0, b: 1, width: 0.1}) })
    // display(regionProbs)
    var firstTermPrefWeight  = uniformDrift({a: 1, b: 5, width: 0.5}) // 1 + exponential({a:1}) //uniformDrift({a: 1, b: 10, width: 1})
    // display(firstTermPrefWeight)
    var nvcWeight = 1//uniformDrift({a: 0, b: 2, width: 0.25}) //exponential({a: 1})
    // display(nvcWeight)

    // var full_venn_space = Enumerate(function() {
  	var VennPrior = makeVennPrior(regionProbs)

	  var venn_interpreter = cache(function(sentences) {
	    Infer({
	      model: function() {
	        var venn = sample(VennPrior)
	        // display(venn)
	        foreach(sentences, function(utterance) {
	          var meaningFn = lexicon[utterance.quantifier]
	          condition(
	            flip(noise) ? true :
	            meaningFn(venn, utterance.p1, utterance.p2)
	          )
	        })

	        return vennToString(venn)
	      },
	      method: "enumerate"
	    })
	  }, 10000)

	  var argument_speaker = cache(function(qudVal, observed_premises) {
	    // display("obs prem " + JSON.stringify(observed_premises))
	    // display(qudVal)
	    Infer({
	      model: function() {
	        var alternative_fn_double = alternative_set.double
	        var alternative_fn_single = alternative_set.single
	        var premises = observed_premises.length == 2 ?
	          map(sample,  alternative_fn_double(observed_premises)) :
	          [sample(alternative_fn_single(observed_premises[0]))]

	        // display(premises)
	        // display(qudVal)
	        // display('enter l0')
	        // var LiteralDist = marginalizeVennToStr(venn_interpreter(premises, qud))
	        var LiteralDist = venn_interpreter(premises)
	        // display(JSON.stringify(LiteralDist.support()))
	        // display('l0 score ' + LiteralDist.score(qudVal))
	        factor(speakerOptimality.alpha_1 * LiteralDist.score(qudVal))
	        return premises
	      },
	      method: "enumerate"
	    })
	  }, 10000)


	  var pragmatic_interpreter = cache(function(premises) {
	    // display("pragmatic interpreter")
	    Infer({
	      model: function() {
	        var venn = sample(VennPrior)
	        var qudVal = vennToString(venn)
	        // display(qudVal)
	        // display(JSON.stringify(vennToString(venn)))
	        var SpeakerDist = argument_speaker(qudVal, premises)
	        // display(JSON.stringify(SpeakerDist))
	        observe(SpeakerDist, premises)
	        return vennToString(venn)
	      },
	      method: "enumerate"
	    })
	  }, 10000)


	  var conclusion_model = function(premises){
	    // display('before listener')
			var first_term_preference = firstTermPreference(premises) // A, C, or false
			var prms = {nvcWeight, firstTermPrefWeight}
			// display(first_term_preference)
			// display(prms)
		  var ConclusionPrior = makeConclusionPrior(first_term_preference, prms)
			// display('enter listener')
	    var PremiseInterpretation = pragmatic_interpreter(premises)
	    // display(JSON.stringify(PremiseInterpretation))

	    // display('end listener')

			var conclusionDist = Infer({model: function(){
	      var conclusion = sample(ConclusionPrior)
	      var ConclusionInterpretation = venn_interpreter([conclusion], noise)
	      var venn = sample(PremiseInterpretation)
	      // display(formatSentence(conclusion) + " " + ConclusionInterpretation.score(venn))
	      factor(speakerOptimality.alpha_2 * ConclusionInterpretation.score(venn))
	      return formatSentence(conclusion)
	    }})

	    return conclusionDist

	  }


  	foreach(premise_1s, function(prem_1){
  			foreach(premise_2s, function(prem_2){
          // display(formatSentence(prem_1) + " _ " + formatSentence(prem_2))
          var data_filtered = _.filter(df_clean, {prem_1, prem_2})
          // display(data_filtered)
  				var syllogisticPremises = [prem_1, prem_2]
          // display(syllogisticPremises)
          // display('before rsa')
          // display(pragmatics)
          // display(JSON.stringify(syllogisticPremises))
          var rsaPredictions = conclusion_model(syllogisticPremises)
          // display('after rsa')
          // var rsaNoise = addNoise(rsaPredictions, noise)
          // display(JSON.stringify(rsaNoise))

          mapData({data: _.map(data_filtered, "conclusion")}, function(d){
            var scr = rsaPredictions.score(d)
            // display(scr)
            scr == -Infinity ? display(formatSentence(prem_1) + " _ " + formatSentence(prem_2) + " _ " + d) : null

            observe(rsaPredictions, d)
          })

  				foreach(rsaPredictions.support(), function(s){

  					query.add(
  						["prediction", formatSentence(prem_1), formatSentence(prem_2), s],
  						Math.exp(rsaPredictions.score(s))
  					)
  				})
  			})
  	})

  	query.add(["parameter", "speakerOptimality", "alpha_1", -99], speakerOptimality.alpha_1)
  	query.add(["parameter", "speakerOptimality", "alpha_2", -99], speakerOptimality.alpha_2)
  	query.add(["parameter", "noise", -99, -99], noise)
  	query.add(["parameter", "firstTermPreference", -99, -99], firstTermPrefWeight)
  	query.add(["parameter", "nvcWeight", -99, -99], nvcWeight)

  	var xkh = map2(function(region, priorProb) {
  		var regionLabel = parseVennDiagram(region)
  		query.add(["parameter", "statePrior", regionLabel, -99], priorProb)
  	}, regions, regionProbs)

  	return query

  }
